{"version":3,"sources":["docs/x-sdk/chat-provider-custom.zh-CN.md?type=text"],"sourcesContent":["\n  import '/home/runner/work/x/x/packages/x/docs/x-sdk/chat-provider-custom.zh-CN.md?watch=parent';\n  export const texts = [{\"value\":\"当内置的 Chat Provider 不满足需求时，可以通过实现抽象类 \",\"paraId\":0},{\"value\":\"AbstractChatProvider\",\"paraId\":0},{\"value\":\" (仅包含三个抽象方法)，可以将不同的模型提供商、或者 Agentic 服务数据转换为可被 \",\"paraId\":0},{\"value\":\"useXChat\",\"paraId\":0},{\"value\":\" 消费的格式，从而实现不同模型、Agent之间的无缝接入和切换。\",\"paraId\":0},{\"value\":\"AbstractChatProvider\",\"paraId\":1,\"tocIndex\":0},{\"value\":\" 是一个抽象类，用于定义 \",\"paraId\":1,\"tocIndex\":0},{\"value\":\"Chat Provider\",\"paraId\":1,\"tocIndex\":0},{\"value\":\" 的接口。当你需要使用自定义的数据服务时，你可以继承 \",\"paraId\":1,\"tocIndex\":0},{\"value\":\"AbstractChatProvider\",\"paraId\":1,\"tocIndex\":0},{\"value\":\" 并实现其方法，可参考\",\"paraId\":1,\"tocIndex\":0},{\"value\":\"样板间-百宝箱\",\"paraId\":2,\"tocIndex\":0},{\"value\":\"。\",\"paraId\":1,\"tocIndex\":0},{\"value\":\"type MessageStatus = 'local' | 'loading' | 'updating' | 'success' | 'error';\\n\\ninterface ChatProviderConfig<Input, Output> {\\n  request: XRequestClass<Input, Output> | (() => XRequestClass<Input, Output>);\\n}\\n\\ninterface TransformMessage<ChatMessage, Output> {\\n  originMessage?: ChatMessage;\\n  chunk: Output;\\n  chunks: Output[];\\n  status: MessageStatus;\\n}\\n\\nabstract class AbstractChatProvider<ChatMessage, Input, Output> {\\n  constructor(config: ChatProviderConfig<Input, Output>): void;\\n\\n  /**\\n   * 转换onRequest传入的参数，你可以和Provider实例化时request配置中的params进行合并或者额外处理\\n   * @param requestParams 请求参数\\n   * @param options 请求配置，从Provider实例化时request配置中来\\n   */\\n  abstract transformParams(\\n    requestParams: Partial<Input>,\\n    options: XRequestOptions<Input, Output>,\\n  ): Input;\\n\\n  /**\\n   * 将onRequest传入的参数转换为本地（用户发送）的ChatMessage，用于消息渲染\\n   * @param requestParams onRequest传入的参数\\n   */\\n  abstract transformLocalMessage(requestParams: Partial<Input>): ChatMessage;\\n\\n  /**\\n   * 可在更新返回数据时对messages做转换，同时会更新到messages\\n   * @param info\\n   */\\n  abstract transformMessage(info: TransformMessage<ChatMessage, Output>): ChatMessage;\\n}\\n\",\"paraId\":3,\"tocIndex\":0},{\"value\":\"下面是一个自定义 Provider 示例，用于展示如何自定义 \",\"paraId\":4,\"tocIndex\":1},{\"value\":\"Chat Provider\",\"paraId\":4,\"tocIndex\":1},{\"value\":\"，代码示例后有详细解析\",\"paraId\":4,\"tocIndex\":1},{\"value\":\"// 类型定义\\ntype CustomInput = {\\n  query: string;\\n};\\n\\ntype CustomOutput = {\\n  data: string;\\n};\\n\\ntype CustomMessage = {\\n  content: string;\\n  role: 'user' | 'assistant';\\n};\\n\\nclass CustomProvider<\\n  ChatMessage extends CustomMessage = CustomMessage,\\n  Input extends CustomInput = CustomInput,\\n  Output extends CustomOutput = CustomOutput,\\n> extends AbstractChatProvider<ChatMessage, Input, Output> {\\n  transformParams(\\n    requestParams: Partial<Input>,\\n    options: XRequestOptions<Input, Output, ChatMessage>,\\n  ): Input {\\n    if (typeof requestParams !== 'object') {\\n      throw new Error('requestParams must be an object');\\n    }\\n    return {\\n      ...(options?.params || {}),\\n      ...(requestParams || {}),\\n    } as Input;\\n  }\\n  transformLocalMessage(requestParams: Partial<Input>): ChatMessage {\\n    return {\\n      content: requestParams.query,\\n      role: 'user',\\n    } as unknown as ChatMessage;\\n  }\\n  transformMessage(info: TransformMessage<ChatMessage, Output>): ChatMessage {\\n    const { originMessage, chunk } = info || {};\\n    if (!chunk || !chunk?.data || (chunk?.data && chunk?.data?.includes('[DONE]'))) {\\n      return {\\n        content: originMessage?.content || '',\\n        role: 'assistant',\\n      } as ChatMessage;\\n    }\\n    const chunkJson = JSON.parse(chunk.data);\\n    const content = originMessage?.content || '';\\n    return {\\n      content: `${content || ''}${chunkJson.data || ''}`,\\n      role: 'assistant',\\n    } as ChatMessage;\\n  }\\n}\\n\",\"paraId\":5,\"tocIndex\":2},{\"value\":\"1、\",\"paraId\":6,\"tocIndex\":3},{\"value\":\"Agentic\",\"paraId\":6,\"tocIndex\":3},{\"value\":\" 服务流式接口 \",\"paraId\":6,\"tocIndex\":3},{\"value\":\"https://xxx.agent.com/api/stream\",\"paraId\":6,\"tocIndex\":3},{\"value\":\"。\",\"paraId\":6,\"tocIndex\":3},{\"value\":\"接口入参\",\"paraId\":7,\"tocIndex\":3},{\"value\":\"{\\n  \\\"query\\\": \\\"帮我总结今天的科技新闻\\\"\\n}\\n\",\"paraId\":8,\"tocIndex\":3},{\"value\":\"接口出参\",\"paraId\":9,\"tocIndex\":3},{\"value\":\"id:1\\ndata: \\\"好的，\\\"\\n\\nid:2\\ndata: \\\"我将为您\\\"\\n\\nid:3\\ndata: \\\"总结今天\\\"\\n\\nid:4\\ndata: \\\"的科技新闻，\\\"\\n\\n\",\"paraId\":10,\"tocIndex\":3},{\"value\":\"2、那么根据接口可以明确 \",\"paraId\":11,\"tocIndex\":3},{\"value\":\"CustomInput\",\"paraId\":11,\"tocIndex\":3},{\"value\":\" 和 \",\"paraId\":11,\"tocIndex\":3},{\"value\":\"CustomOutput\",\"paraId\":11,\"tocIndex\":3},{\"value\":\" 类型。\",\"paraId\":11,\"tocIndex\":3},{\"value\":\"CustomInput\",\"paraId\":12,\"tocIndex\":3},{\"value\":\" 类型如下\",\"paraId\":12,\"tocIndex\":3},{\"value\":\"{\\n  query: string;\\n}\\n\",\"paraId\":13,\"tocIndex\":3},{\"value\":\"由于输出数据字符串只需要将 data 字符串转为 JSON，然后将内部的 data 字段拼接，那么 \",\"paraId\":14,\"tocIndex\":3},{\"value\":\"CustomOutput\",\"paraId\":14,\"tocIndex\":3},{\"value\":\" 类型如下\",\"paraId\":14,\"tocIndex\":3},{\"value\":\"{\\n  data: string;\\n}\\n\",\"paraId\":15,\"tocIndex\":3},{\"value\":\"3、我们期望 \",\"paraId\":16,\"tocIndex\":3},{\"value\":\"useXChat\",\"paraId\":16,\"tocIndex\":3},{\"value\":\" 生产的 messages 数据可以直接给 Bubble.List 消费，那么可以将 \",\"paraId\":16,\"tocIndex\":3},{\"value\":\"CustomMessage\",\"paraId\":16,\"tocIndex\":3},{\"value\":\" 定义如下：\",\"paraId\":16,\"tocIndex\":3},{\"value\":\"{\\n  content: string;\\n  role: 'user' | 'assistant';\\n}\\n\",\"paraId\":17,\"tocIndex\":3},{\"value\":\"4、然后继承 \",\"paraId\":18,\"tocIndex\":3},{\"value\":\"AbstractChatProvider\",\"paraId\":18,\"tocIndex\":3},{\"value\":\" 并实现其方法，得到 \",\"paraId\":18,\"tocIndex\":3},{\"value\":\"CustomProvider\",\"paraId\":18,\"tocIndex\":3},{\"value\":\"，\",\"paraId\":18,\"tocIndex\":3},{\"value\":\"AbstractChatProvider\",\"paraId\":18,\"tocIndex\":3},{\"value\":\" 内有且仅有三个方法需要实现。\",\"paraId\":18,\"tocIndex\":3},{\"value\":\"transformParams\",\"paraId\":19,\"tocIndex\":3},{\"value\":\" 用于转换 onRequest 传入的参数，你可以和 Provider 实例化时 request 配置中的 params 进行合并或者额外处理。\",\"paraId\":19,\"tocIndex\":3},{\"value\":\"transformLocalMessage\",\"paraId\":19,\"tocIndex\":3},{\"value\":\" 将 onRequest 传入的参数转换为本地（用户发送）的 ChatMessage，用于用户发送消息渲染，同时会更新到 messages，用于消息列表渲染。\",\"paraId\":19,\"tocIndex\":3},{\"value\":\"transformMessage\",\"paraId\":19,\"tocIndex\":3},{\"value\":\" 可在更新返回数据时将数据做转换为 ChatMessage 数据类型，同时会更新到 messages，用于消息列表渲染。\",\"paraId\":19,\"tocIndex\":3},{\"value\":\"5、最后我们可以将 \",\"paraId\":20,\"tocIndex\":3},{\"value\":\"CustomProvider\",\"paraId\":20,\"tocIndex\":3},{\"value\":\" 实例化并传入 \",\"paraId\":20,\"tocIndex\":3},{\"value\":\"useXChat\",\"paraId\":20,\"tocIndex\":3},{\"value\":\" 中，即可完成自定义 Provider 的使用。\",\"paraId\":20,\"tocIndex\":3},{\"value\":\"const [provider] = React.useState(\\n  new CustomProvider({\\n    request: XRequest<CustomInput, CustomOutput>('https://xxx.agent.com/api/stream', {\\n      manual: true,\\n    }),\\n  }),\\n);\\n\\nconst { onRequest, messages, setMessages, setMessage, isRequesting, abort, onReload } = useXChat({\\n  provider,\\n});\\n\",\"paraId\":21,\"tocIndex\":3},{\"value\":\"6、发送请求\",\"paraId\":22,\"tocIndex\":3},{\"value\":\"onRequest({\\n  query: '帮我总结今天的科技新闻',\\n});\\n\",\"paraId\":23,\"tocIndex\":3},{\"value\":\"我们欢迎社区贡献新的 Chat Provider！请按照以下规范进行 Chat Provider 开发。\",\"paraId\":24,\"tocIndex\":6},{\"value\":\"这篇指南会指导你如何为 Ant Design 贡献自己的一份力量，请你在提 issue 或者 pull request 之前花几分钟来阅读一遍这篇\",\"paraId\":25,\"tocIndex\":7},{\"value\":\"贡献指南\",\"paraId\":26,\"tocIndex\":7},{\"value\":\"。\",\"paraId\":25,\"tocIndex\":7},{\"value\":\"Chat Provider 应遵循以下规范：\",\"paraId\":27,\"tocIndex\":8},{\"value\":\"Chat Provider 应包含在 \",\"paraId\":28,\"tocIndex\":8},{\"value\":\"packages/x-sdk/src/chat-providers\",\"paraId\":28,\"tocIndex\":8},{\"value\":\" 目录下。\",\"paraId\":28,\"tocIndex\":8},{\"value\":\"Chat Provider Type 应包含在 \",\"paraId\":28,\"tocIndex\":8},{\"value\":\"packages/x-sdk/src/chat-providers/type\",\"paraId\":28,\"tocIndex\":8},{\"value\":\" 目录下。\",\"paraId\":28,\"tocIndex\":8},{\"value\":\"Chat Provider 主题文件应遵循以下命名规则：\",\"paraId\":29,\"tocIndex\":9},{\"value\":\"Chat Provider 主题文件应以 \",\"paraId\":30,\"tocIndex\":9},{\"value\":\"[供应商][类型][版本].ts\",\"paraId\":30,\"tocIndex\":9},{\"value\":\" 驼峰格式的方式命名。\",\"paraId\":30,\"tocIndex\":9},{\"value\":\"如果是特定模型可直接以\",\"paraId\":30,\"tocIndex\":9},{\"value\":\"[供应商][模型名称].ts\",\"paraId\":30,\"tocIndex\":9},{\"value\":\" 驼峰格式的方式命名。\",\"paraId\":30,\"tocIndex\":9}];\n  "],"names":[],"mappings":"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"}